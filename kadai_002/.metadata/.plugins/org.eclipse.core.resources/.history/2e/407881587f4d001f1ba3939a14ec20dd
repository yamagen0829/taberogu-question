package com.example.nagoyameshi.service;

import java.time.LocalDate;
import java.time.LocalTime;

import org.springframework.stereotype.Service;

@Service
public class ReservationService {
	private final ReservationRepository reservationRepository;  
    private final RestaurantRepository houseRepository;  
    private final UserRepository userRepository;  
    
    public ReservationService(ReservationRepository reservationRepository, RestaurantRepository houseRepository, UserRepository userRepository) {
        this.reservationRepository = reservationRepository;  
        this.restaurantRepository = restaurantRepository;  
        this.userRepository = userRepository;  
    }    
    
    @Transactional
    public void create(ReservationRegisterForm reservationRegisterForm) { 
        Reservation reservation = new Reservation();
        Restaurant restaurant = restaurantRepository.getReferenceById(reservationRegisterForm.getHouseId());
        User user = userRepository.getReferenceById(reservationRegisterForm.getUserId());
        LocalDate reservationDate = LocalDate.parse(reservationRegisterForm.getReservationDate());
        LocalTime reservationTime = LocalTime.parse(reservationRegisterForm.getReservationTime());         
                
        reservation.setRestaurant(restaurant);
        reservation.setUser(user);
        reservation.setReservationDate(reservationDate);
        reservation.setReservationTime(reservationTime);
        reservation.setNumberOfPeople(reservationRegisterForm.getNumberOfPeople());
        reservation.setAmount(reservationRegisterForm.getAmount());
        
        reservationRepository.save(reservation);
    }    
    
  // 人数が定員以下かどうかをチェックする
	public boolean isWithinNumberOfSeat(Integer numberOfPeople, Integer numberOfSeat) {
		return numberOfPeople <= numberOfSeat;
	}

  // 料金を計算する
	public Integer calculateAmount(LocalDate reservationDate, LocalTime reservationTime, Integer price, Integer numberOfPeople) {
		int amount = price * numberOfPeople;
		return amount;
	}
}
